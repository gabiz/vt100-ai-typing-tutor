# Requirements Document

## Introduction

The AI Chat Improvements feature enhances the existing AI Typing Tutor's chat functionality by upgrading from pattern matching to intelligent intent detection using Claude Haiku 4.5. The system will provide structured responses with clear intent classification, targeted typing text generation, and improved user interaction handling.

## Glossary

- **AI_Chat_Service**: The enhanced AI service that handles user interactions through a single Claude Haiku 4.5 call with structured JSON responses
- **Structured_Response**: A JSON response format containing intent, typing-text, and response fields generated by the AI model
- **Claude_Haiku_4_5**: The upgraded Anthropic language model (claude-haiku-4-5-20251001) that handles all AI functionality
- **Intent_Classification**: The AI model's ability to classify user messages into chitchat, session-analysis, or session-suggest categories
- **Targeted_Exercise_Generation**: The AI model's capability to create typing exercises with specific requirements through proper prompting

## Requirements

### Requirement 1

**User Story:** As a typing learner, I want the AI to intelligently understand my intent, so that I receive appropriate responses whether I'm asking for exercises, analysis, or general conversation.

#### Acceptance Criteria

1. WHEN a user sends any message to the chat THEN the AI_Chat_Service SHALL make a single call to Claude Haiku 4.5 with comprehensive prompting
2. WHEN the AI model processes the request THEN it SHALL return a JSON response with intent classification and appropriate content
3. WHEN the intent is chitchat THEN the JSON response SHALL contain guidance to focus on typing training with null typing-text
4. WHEN the intent is session-analysis THEN the JSON response SHALL contain performance insights with null typing-text
5. WHEN the intent is session-suggest THEN the JSON response SHALL contain both a chat response and generated typing exercise text

### Requirement 2

**User Story:** As a typing student, I want the AI to generate precise typing exercises with exact word counts, so that I can practice with content that meets my specific requirements.

#### Acceptance Criteria

1. WHEN a user requests a specific word count THEN the AI model SHALL generate text with EXACTLY that number of words through proper prompting
2. WHEN no specific word count is requested THEN the AI model SHALL generate between 30 and 40 words as instructed in the prompt
3. WHEN word count requirements are specified in the prompt THEN the AI model SHALL follow them precisely
4. WHEN the AI generates typing text THEN it SHALL count words accurately as instructed in the system prompt
5. WHEN typing text is generated THEN the JSON response SHALL contain the text in the typing-text field

### Requirement 3

**User Story:** As a user practicing specific keys, I want the AI to create targeted drills using only those keys, so that I can focus on improving my weakest areas.

#### Acceptance Criteria

1. WHEN a user requests practice for specific keys THEN the AI model SHALL create text using ONLY those keys as instructed in the prompt
2. WHEN generating key-focused drills THEN the AI model SHALL create sequences using exclusively the requested keys (e.g., "asaa dass dsdsd" for a,s,d keys)
3. WHEN specific key drills are requested THEN the AI model SHALL generate text containing ONLY the specified keys with spaces between sequences
4. WHEN key drills are created THEN the AI model SHALL form varied patterns and combinations using only the target keys
5. WHEN key practice is requested THEN the AI model SHALL classify the intent as session-suggest and include appropriate drill text

### Requirement 4

**User Story:** As a developer integrating the AI service, I want consistent structured responses, so that I can reliably parse and use the AI output in the application.

#### Acceptance Criteria

1. WHEN any AI request is processed THEN the AI model SHALL return a valid JSON response as instructed in the system prompt
2. WHEN the JSON response is generated THEN it SHALL contain intent, typing-text, and response fields
3. WHEN the intent is chitchat or session-analysis THEN the typing-text field SHALL be null or empty
4. WHEN the intent is session-suggest THEN the typing-text field SHALL contain valid typing exercise content
5. WHEN the application parses the response THEN the JSON SHALL be valid and parseable without errors

### Requirement 5

**User Story:** As a typing tutor application, I want to use the latest Claude Haiku 4.5 model, so that I can provide users with improved AI capabilities and more accurate responses.

#### Acceptance Criteria

1. WHEN the AI service initializes THEN it SHALL use the claude-haiku-4-5-20251001 model identifier
2. WHEN API calls are made THEN the AI_Chat_Service SHALL connect to the Claude Haiku 4.5 endpoint
3. WHEN model responses are received THEN they SHALL demonstrate improved intent detection compared to the previous pattern matching approach
4. WHEN the service processes requests THEN it SHALL use the upgraded model's enhanced capabilities
5. WHEN the upgrade is complete THEN the AI_Chat_Service SHALL maintain backward compatibility with existing chat functionality

### Requirement 6

**User Story:** As a typing learner, I want the AI to handle off-topic conversations gracefully, so that I stay focused on my typing improvement goals.

#### Acceptance Criteria

1. WHEN a user asks unrelated questions THEN the AI model SHALL classify the intent as chitchat through proper prompt instructions
2. WHEN chitchat intent is detected THEN the JSON response SHALL redirect the user to typing-focused activities
3. WHEN off-topic requests are made THEN the AI model SHALL not generate typing exercise text (typing-text field null)
4. WHEN redirecting users THEN the response field SHALL be helpful and encouraging rather than dismissive
5. WHEN maintaining focus THEN the AI model SHALL suggest specific typing activities or exercises in the response

### Requirement 7

**User Story:** As a user with performance data, I want the AI to analyze my typing sessions intelligently, so that I receive personalized improvement recommendations.

#### Acceptance Criteria

1. WHEN session analysis is requested THEN the AI model SHALL examine the user's performance history provided in the prompt context
2. WHEN performance data exists THEN the AI model SHALL identify specific areas for improvement through analysis
3. WHEN analysis is complete THEN the AI model SHALL provide actionable recommendations in the response field
4. WHEN weak areas are identified THEN the response SHALL suggest specific exercises or practice methods
5. WHEN analysis intent is detected THEN the typing-text field SHALL remain null as no new exercise is generated

### Requirement 8

**User Story:** As a user having a conversation with the AI, I want the system to remember recent context, so that my interactions feel natural and coherent.

#### Acceptance Criteria

1. WHEN making a request to the AI model THEN the AI_Chat_Service SHALL include the last 5 messages from chat history in the prompt context
2. WHEN conversation history exists THEN the AI model SHALL use this context to provide more relevant responses
3. WHEN no previous messages exist THEN the AI model SHALL process the request without historical context
4. WHEN including message history THEN the AI_Chat_Service SHALL format the conversation context appropriately for the model
5. WHEN processing requests with context THEN the AI model SHALL maintain conversation coherence and reference previous interactions when relevant